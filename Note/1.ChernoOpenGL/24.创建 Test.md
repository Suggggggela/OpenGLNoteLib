这节我们会完善测试框架

## 一、Test Menu
我们目标的测试框架是在ImGui中显示一个测试菜单，菜单中有各种测试选项，点击选项后进入测试，退出后返回测试菜单

首先我们在Test的头文件中创建TestMenu
```cpp
class TestMenu : public Test
{
public:
	TestMenu(Test*& currentTestPointer); //*&是引用指针，currentTestPointer是指向Test的指针
	~TestMenu();

	void OnImGuiRender() override;
	template<typename T>
	void RegisterTest(const std::string& name)
	{
		//debug
		std::cout << "Register Test:" << name << std::endl;
		m_Tests.push_back(std::make_pair(name, []() {return new T(); }));
	}
private:
	Test*& m_CurrentTest;//激活的测试
	std::vector<std::pair<std::string, std::function<Test*()>>> m_Tests;//测试列表
};
```

接下来在test的cpp中填充方法，在gui中把pair的第一个变量作为名称，第二个作为其test的指针
```cpp
TestMenu::TestMenu(Test*& currentTestPointer)
	: m_CurrentTest(currentTestPointer)
{
}

TestMenu::~TestMenu()
{
}

void TestMenu::OnImGuiRender()
{
	for (auto& test : m_Tests)
	{
		//这里的first和second是pair的成员变量，first是string类型，second是function类型
		if (ImGui::Button(test.first.c_str()))
		{
			m_CurrentTest = test.second();
		}
	}
}
```


## 二、TestClearColor
接下来我们以上节的clearcolor测试为例
```cpp
#pragma once
#include "Test.h"

namespace test
{
	class TestClearColor : public Test 
	{
	public:
		TestClearColor();
		~TestClearColor();

		void OnUpdate(float deltaTime) override;
		void OnRender() override;
		void OnImGuiRender() override;
	private:
		float m_ClearColor[4];
	};
}
```

```cpp
#include "TestClearColor.h"
#include "Renderer.h"
#include "imgui\imgui.h"

namespace test {

	test::TestClearColor::TestClearColor()
		: m_ClearColor{0.2f, 0.3f, 0.8f, 1.0f} //初始化成员列表，给个默认clearcolor
	{
	}
	test::TestClearColor::~TestClearColor()
	{
	}
	void test::TestClearColor::OnUpdate(float deltaTime)
	{

	}
	void test::TestClearColor::OnRender()
	{
    	//调用opengl，使用m_ClearColor作为clearcolor
		GLCall(glClearColor(m_ClearColor[0], m_ClearColor[1], m_ClearColor[2], m_ClearColor[3]));
		GLCall(glClear(GL_COLOR_BUFFER_BIT));
	}

	void test::TestClearColor::OnImGuiRender()
	{
		ImGui::ColorEdit4("Clear Color", m_ClearColor);//ClearColor测试的GUI
	}

}
```

## 三、使用测试
```cpp

//TestFramework
test::Test* currentTest = nullptr;
test::TestMenu* testMenu = new test::TestMenu(currentTest);//创建TestMenu 
currentTest = testMenu;

//注册clearcolor测试到测试菜单
testMenu->RegisterTest<test::TestClearColor>("Clear Color");

//RenderLoop
/* Loop until the user closes the window */
while (!glfwWindowShouldClose(window))
{
	GLCall(glClearColor(0.0f, 0.0f, 0.0f, 1.0f));
	renderer.Clear();

	
	//imgui
	ImGui_ImplGlfwGL3_NewFrame();
	//TestFramework
	if (currentTest)
	{
		currentTest->OnUpdate(0.0f);
		currentTest->OnRender();
		ImGui::Begin("Test");
		if (currentTest != testMenu && ImGui::Button("<-"))//当前test不是菜单时，生成返回按钮
		{
    		//当点击返回按钮时，释放内存，把currentTest指向testMenu
			delete currentTest;
			currentTest = testMenu;
		}
		currentTest->OnImGuiRender();
		ImGui::End();
	}
	//imgui
	ImGui::Render();
	ImGui_ImplGlfwGL3_RenderDrawData(ImGui::GetDrawData());

	glfwSwapBuffers(window);
	glfwPollEvents();
}
```